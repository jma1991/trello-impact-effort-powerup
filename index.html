<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
</head>
<body>
  <h1>Impact-Effort Matrix Power-Up</h1>
  <p>This is the connector page for the Power-Up.</p>

  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script>
    var POPUP_URL = './popup.html';
    var ICON_URL = './icon.svg';

    // Quadrant definitions
    var QUADRANTS = {
      quickWin: { name: 'Quick Win', color: 'green' },
      majorProject: { name: 'Major Project', color: 'blue' },
      fillIn: { name: 'Fill-in', color: 'yellow' },
      thanklessTask: { name: 'Thankless Task', color: 'red' }
    };

    function getQuadrant(impact, effort) {
      if (impact === 'high' && effort === 'low') return QUADRANTS.quickWin;
      if (impact === 'high' && effort === 'high') return QUADRANTS.majorProject;
      if (impact === 'low' && effort === 'low') return QUADRANTS.fillIn;
      if (impact === 'low' && effort === 'high') return QUADRANTS.thanklessTask;
      return null;
    }

    TrelloPowerUp.initialize({
      'card-buttons': function(t, options) {
        return [{
          icon: ICON_URL,
          text: 'Impact / Effort',
          callback: function(t) {
            return t.popup({
              title: 'Impact / Effort',
              url: POPUP_URL,
              height: 184
            });
          }
        }];
      },
      'card-badges': function(t, options) {
        return t.get('card', 'shared', 'impactEffort')
          .then(function(data) {
            if (!data || !data.impact || !data.effort) {
              return [];
            }
            var quadrant = getQuadrant(data.impact, data.effort);
            if (!quadrant) return [];
            return [{
              text: quadrant.name,
              color: quadrant.color
            }];
          });
      },
      'card-detail-badges': function(t, options) {
        return t.get('card', 'shared', 'impactEffort')
          .then(function(data) {
            if (!data || !data.impact || !data.effort) {
              return [];
            }
            var quadrant = getQuadrant(data.impact, data.effort);
            return [
              {
                title: 'Impact',
                text: data.impact === 'high' ? 'High' : 'Low',
                callback: function(t) {
                  return t.popup({
                    title: 'Impact / Effort',
                    url: POPUP_URL,
                    height: 184
                  });
                }
              },
              {
                title: 'Effort',
                text: data.effort === 'high' ? 'High' : 'Low',
                callback: function(t) {
                  return t.popup({
                    title: 'Impact / Effort',
                    url: POPUP_URL,
                    height: 184
                  });
                }
              },
              {
                title: 'Quadrant',
                text: quadrant ? quadrant.name : '-',
                color: quadrant ? quadrant.color : null
              }
            ];
          });
      }
    });
  </script>
</body>
</html>
